<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Регистрация</title>
		<link rel="stylesheet" href="./vendor/normalize.css">
		<link rel="stylesheet" href="./styles/main.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  </head>
  <body>
		<header class="container-fluid colors">
			<nav class="navbar navbar-expand-md d-flex justify-content-between">
				<div>
					<a class="colors navbar-brand text-white fs-4 p-2" href="./main.html">Главная</a>
					<a class="colors navbar-brand text-white fs-6 p-2" href="./calendar.html">Календарь</a>
				</div>
				<div>
					<button class="colors navbar-brand text-white fs-6" id="entry">Вход</button>
					<button class="colors navbar-brand text-white fs-6 button-logout" id="exit">Выход</button>
					<button class="colors navbar-brand text-white fs-6" id="register">Регистрация</button>
					<button class="colors navbar-brand text-white fs-5 p-2" id="lc">Личный кабинет</button>
				</div>
			</nav>
		</header>

		<main class="container-xl p-5">
			<form class="d-flex-column" onsubmit="register(event)">
				<h1 class="row mb-5 justify-content-center">Регистрация</h1>
				<div class="row mb-3 justify-content-center">
					<label for="inputName3" class="col-sm-1 col-form-label">Имя</label>
					<div class="col-sm-3">
						<input type="text" class="form-control" name="firstname" id="inputName3" placeholder="Алексей" required>
					</div>
				</div>
				<div class="row mb-3 justify-content-center">
					<label for="inputSurname3" class="col-sm-1 col-form-label">Фамилия</label>
					<div class="col-sm-3">
						<input type="text" class="form-control" name="lastname" id="inputSurname3" placeholder="Кондратьев" required>
					</div>
				</div>
				<div class="row mb-3 justify-content-center">
					<label for="inputEmail3" class="col-sm-1 col-form-label">Почта</label>
					<div class="col-sm-3">
						<input type="email" class="form-control" name="email" id="inputEmail3" placeholder="example@email.com" required>
					</div>
				</div>
				<div class="row mb-3 justify-content-center">
					<label for="inputLogin3" class="col-sm-1 col-form-label">Логин</label>
					<div class="col-sm-3">
						<input type="text" class="form-control" name="login" id="inputLogin3" placeholder="9Anpanman" required>
					</div>
				</div>
				<div class="row mb-3 justify-content-center">
					<label for="inputPassword3" class="col-sm-1 col-form-label">Пароль</label>
					<div class="col-sm-3">
						<input type="password" class="form-control" name="password" id="inputPassword3" required>
					</div>
				</div>
				<div class="row justify-content-center">
					<div class="col-sm-4">
						<button type="submit" class="btn btn-primary">Зарегистрироваться</button>
					</div>
				</div>
			</form>
		</main>

		<footer class="container-fluid pt-5 colors">
			<div class="row justify-content-between p-2">
				<div class="col-2">
					<h5>Ваш аккаунт</h5>
					<ul class="nav flex-column">
						<li class="nav-item mb-2"><a href="./personal-area.html" class="nav-link p-0 text-white">Личный кабинет</a></li>
						<li class="nav-item mb-2"><a href="./entry.html" class="nav-link p-0 text-white">Вход</a></li>
						<li class="nav-item mb-2"><a href="./reqistration.html" class="nav-link p-0 text-white">Регистрация</a></li>
					</ul>
				</div>
	
				<div class="col-2">
					<h5>Найти</h5>
					<ul class="nav flex-column">
						<li class="nav-item mb-2"><a href="./calendar.html" class="nav-link p-0 text-white">Календарь</a></li>
						<li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-white">Поиск мероприятий</a></li>
					</ul>
				</div>
	
				<div class="col-2">
					<h5>О нас</h5>
					<ul class="nav flex-column">
						<li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-white">ВКонтакте</a></li>
						<li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-white">Телеграм</a></li>
					</ul>
				</div>
	
				<div class="col-4 offset-1">
					<form>
						<h5>Подпишись на нас, чтобы не пропустить ничего интересного</h5>
						<div class="d-flex w-100 gap-2">
							<label for="newsletter1" class="visually-hidden">Ваша почта</label>
							<input id="newsletter1" type="text" class="form-control" placeholder="example@email.com">
							<button class="btn btn-primary" type="button">Подписаться</button>
						</div>
					</form>
				</div>
			</div>
	
			<div class="d-flex justify-content-between py-4 my-4 border-top">
				<p>&copy 2022, Кондратьев Алексей</p>
				<ul class="list-unstyled d-flex">
					<li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#twitter"></use></svg></a></li>
					<li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#instagram"></use></svg></a></li>
					<li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#facebook"></use></svg></a></li>
				</ul>
			</div>
		</footer>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
		<script src="./scripts/header.js"></script>
		<script>
			function checkAuth() {
			if (localStorage.accessToken) {
				window.location.href = "http://localhost:8000/main.html"
			}
		}

		async function register(event) {
			event.preventDefault()

			const inputs = Array.from(event.target.querySelectorAll('input'))

			const loginData = {}

			for (const input of inputs) {
				loginData[input.name] = input.value
			}

			console.log('login data', loginData)

			const response = await fetch('http://localhost:3000/register', {
				method: "POST",
				body: JSON.stringify(loginData),
				headers: {
					'Content-Type': 'application/json'
				}
			})

			const responseJson = await response.json()

			const { accessToken, user } = responseJson

			console.log('response', responseJson)

			localStorage.accessToken = accessToken
			localStorage.user = JSON.stringify(user)

			window.location.href = "http://localhost:8000/main.html"
		}
	
		document.addEventListener('DOMContentLoaded', () => checkAuth())
		</script>
	</body>
</html>
