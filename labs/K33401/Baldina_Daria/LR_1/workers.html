<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>

  <title>Сотрудники</title>
</head>


<body>
  <header>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-2">
      <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Intro</a>
      <input class="form-control form-control-dark w-100" id="myInput" onkeyup="departmentFilter()" type="text" placeholder="Поиск" aria-label="Search">
      <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
          <a class="nav-link" onclick="logout()">Выйти</a>
        </li>
      </ul>
    </nav>
  </header>

  <main class="container-fluid row gx-0">
    <aside class="col-lg-4 py-2 vh-100" style="background-color: #f7f4ef ">
      <ul class="list-group col-12">
        <li class="list-group-item">
            <a href="manage.html" class="text-decoration-none link-dark">Домашняя страница</a> 
        <li class="list-group-item ">
          <a href="products.html" class="text-decoration-none link-dark">Учет товара</a>
        </li>
        <li class="list-group-item list-group-item-secondary" aria-current="true">
            Персонал
        </li>
        <li class="list-group-item">
          <a href="sales.html" class="text-decoration-none link-dark">Продажи</a> 
        </li>
      </ul>
    </aside>
    <section class="col-lg-8 vh-100 py-2 px-3" style="background-color: #f7f7f7d3">
        <h2>Информация о сотрудниках компании</h2>
        <div class="table-responsive">
          <table id = "myTable" class="table table-striped table-sm">
            <thead>
              <tr>
                <th>Табельный номер</th>
                <th>Фамилия</th>
                <th>Имя</th>
                <th>Отчество</th>
                <th>Отдел</th>
              </tr>
            </thead>
            <tbody id = "new_row">
              <tr>
                <td>1,001</td>
                <td>Иванов</td>
                <td>Иван</td>
                <td>Андреевич</td>
                <td>Продажи</td>
              </tr>
              <tr>
                <td>1,002</td>
                <td>Артемьева</td>
                <td>Анастасия</td>
                <td>Григорьевна</td>
                <td>Аналитика</td>
              </tr>
              <tr>
                <td>1,003</td>
                <td>Мелкина</td>
                <td>Дарья</td>
                <td>Олеговна</td>
                <td>Аналитика</td>
              </tr>
              <tr>
                <td>1,004</td>
                <td>Горбин</td>
                <td>Дмитрий</td>
                <td>Иванович</td>
                <td>Тех.отдел</td>
              </tr>
              <tr>
                <td>1,005</td>
                <td>Бурак</td>
                <td>Дарина</td>
                <td>Александровна</td>
                <td>Маркетинг</td>
              </tr>
              <tr>
                <td>1,006</td>
                <td>Алексеев</td>
                <td>Петр</td>
                <td>Андреевич</td>
                <td>Тех.отдел</td>
              </tr>
              <tr>
                <td>1,007</td>
                <td>Ивакина</td>
                <td>Светлана</td>
                <td>Даниловна</td>
                <td>Тех.отдел</td>
              </tr>
              <tr>
                <td>1,008</td>
                <td>Иванов</td>
                <td>Иван</td>
                <td>Андреевич</td>
                <td>Продажи</td>
              </tr>
              <tr>
                <td>1,009</td>
                <td>Столетов</td>
                <td>Александр</td>
                <td>Дмитриевич</td>
                <td>Продажи</td>
              </tr>
              <tr>
                <td>1,010</td>
                <td>Панин</td>
                <td>Егор</td>
                <td>Алексеевич</td>
                <td>Маркетинг</td>
              </tr>
              <tr>
                <td>1,011</td>
                <td>Краснова</td>
                <td>Екатерина</td>
                <td>Михайловна</td>
                <td>Управление</td>
              </tr>
              <tr>
                <td>1,012</td>
                <td>Разина</td>
                <td>Лилия</td>
                <td>Владиславовна</td>
                <td>Аналитика</td>
              </tr>
              <tr>
                <td>1,013</td>
                <td>Еремеев</td>
                <td>Тимофей</td>
                <td>Андреевич</td>
                <td>Управление</td>
              </tr>
              <tr>
                <td>1,014</td>
                <td>Ильин</td>
                <td>Артем</td>
                <td>Игоревич</td>
                <td>Маркетинг</td>
              </tr>
              <tr>
                <td>1,015</td>
                <td>Степанова</td>
                <td>Анна</td>
                <td>Анатольевна</td>
                <td>Управление</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      </main>
    </div>
  </div>
    <script>
      function departmentFilter() {
        var input, filter, table, tr, td, i;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("myTable");
        tr = table.getElementsByTagName("tr");
      
        for (i = 0; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[4];
          if (td) {
            if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
              tr[i].style.display = "";
            } else {
              tr[i].style.display = "none";
            }
          }
        }
      }
      function logout() {
      localStorage.clear()
      window.location.href = "http://127.0.0.1:5500/labs/K33401/Baldina_Daria/LR_1/main_page.html"
    }
    function createTable (id, last_name, first_name, middle_name, department) {
      return  `<tr>
                    <td>${id}</td>
                    <td>${last_name}</td>
                    <td>${first_name}</td>
                    <td>${middle_name}</td>
                    <td>${department}</td>
              </tr>` 
    }

    function getAuthToken() {
      return localStorage.accessToken
    }

    async function getDataFromDb(){
      const response = await fetch('http://localhost:3000/600/workers', {
            method: "GET",
            headers: {
              "Authorization": `Bearer ${getAuthToken()}`
          }
        })
      
      responseJson = await response.json()
      parcedData = JSON.parse(JSON.stringify(responseJson))

      for (i = 0; i < Object.keys(responseJson).length; i++){
        var id = responseJson[i].id
        var last_name = responseJson[i].last_name
        var name = responseJson[i].name
        var middle_name = responseJson[i].middle_name
        var department = responseJson[i].departure_name
        document.querySelector("#new_row").innerHTML += createTable(id, last_name,name,middle_name,department)
      }
      }
      document.addEventListener('DOMContentLoaded', () => { getDataFromDb()} )

      </script>
  </main>
</body>
</html>